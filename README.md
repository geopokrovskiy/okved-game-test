# Игра «Найди свой ОКВЭД по номеру телефона» (Тестовое задание на должность Ведущего Java-разработчика в Правительство Москвы )

## Задача

* Принять строку содержащую **российский мобильный номер** в любом формате (ввод без ограничений). Спроектировать общий алгоритм нормализации. Результат — строго `+79XXXXXXXXX`. Если нормализовать нельзя — вернуть `false` + ошибку.

* По HTTPS загрузить `okved.json` из этого репозитория (файл обновляется ежедневно).

* Найти код ОКВЭД с максимальным совпадением по **окончанию** нормализованного номера. Если совпадений нет — применить **резервную стратегию** (на выбор разработчика).

* Вывести нормализованный номер, найденный ОКВЭД (код и название), длину совпадения.

* Это игра — в приоритете полные совпадения. Каждый шаг оформить как отдельную функцию/класс (в зависимости от языка программирования).

* Код следует единому стандарту документации/комментариев. Укажите, какому стандарту придерживается ваше решение (на выбор разработчика).

* Разрешается использовать библиотеки, фреймворки и boilerplates с открытой лицензией **MIT (или эквивалентной)** при условии предоставления ссылки на источник в README.

* В приоритете качество кода, а не его количество. Приложить краткую инструкцию по запуску.


## Краткое описание решения

* Предложенное решение написано на языке Java с использованием SpringBoot. Sequence-диаграмма классов и компонент:
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="733px" preserveAspectRatio="none" style="width:1217px;height:733px;background:#FFFFFF;" version="1.1" viewBox="0 0 1217 733" width="1217px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="389.9961" style="stroke:#000000;stroke-width:1.5;" width="999.2607" x="10" y="180.7852"/><g><title>Actor</title><rect fill="#000000" fill-opacity="0.00000" height="657.0332" width="8" x="39.3379" y="38.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="43" x2="43" y1="38.6211" y2="695.6543"/></g><g><title>OkvedController</title><rect fill="#000000" fill-opacity="0.00000" height="657.0332" width="8" x="338.6929" y="38.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="342.1172" x2="342.1172" y1="38.6211" y2="695.6543"/></g><g><title>OkvedProcessor</title><rect fill="#000000" fill-opacity="0.00000" height="657.0332" width="8" x="511.5518" y="38.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="514.8105" x2="514.8105" y1="38.6211" y2="695.6543"/></g><g><title>NumberNormalizer</title><rect fill="#000000" fill-opacity="0.00000" height="657.0332" width="8" x="690.8789" y="38.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="694.1445" x2="694.1445" y1="38.6211" y2="695.6543"/></g><g><title>OkvedService</title><rect fill="#000000" fill-opacity="0.00000" height="657.0332" width="8" x="817.1855" y="38.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="820.6133" x2="820.6133" y1="38.6211" y2="695.6543"/></g><g><title>OkvedScheduler</title><rect fill="#000000" fill-opacity="0.00000" height="657.0332" width="8" x="936.5093" y="38.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="939.7578" x2="939.7578" y1="38.6211" y2="695.6543"/></g><g><title>GitHub</title><rect fill="#000000" fill-opacity="0.00000" height="657.0332" width="8" x="1172.4956" y="38.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1175.7095" x2="1175.7095" y1="38.6211" y2="695.6543"/></g><g class="participant participant-head" data-participant="A"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="46.6758" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.6758" x="27" y="27.1074">Actor</text></g><g class="participant participant-tail" data-participant="A"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="46.6758" x="20" y="694.6543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.6758" x="27" y="716.7617">Actor</text></g><g class="participant participant-head" data-participant="OC"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115.1514" x="285.1172" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.1514" x="292.1172" y="27.1074">OkvedController</text></g><g class="participant participant-tail" data-participant="OC"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115.1514" x="285.1172" y="694.6543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.1514" x="292.1172" y="716.7617">OkvedController</text></g><g class="participant participant-head" data-participant="OP"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.4824" x="456.8105" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.4824" x="463.8105" y="27.1074">OkvedProcessor</text></g><g class="participant participant-tail" data-participant="OP"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.4824" x="456.8105" y="694.6543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.4824" x="463.8105" y="716.7617">OkvedProcessor</text></g><g class="participant participant-head" data-participant="NN"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131.4688" x="629.1445" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.4688" x="636.1445" y="27.1074">NumberNormalizer</text></g><g class="participant participant-tail" data-participant="NN"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131.4688" x="629.1445" y="694.6543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.4688" x="636.1445" y="716.7617">NumberNormalizer</text></g><g class="participant participant-head" data-participant="OS"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.1445" x="770.6133" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.1445" x="777.6133" y="27.1074">OkvedService</text></g><g class="participant participant-tail" data-participant="OS"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.1445" x="770.6133" y="694.6543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.1445" x="777.6133" y="716.7617">OkvedService</text></g><g class="participant participant-head" data-participant="OSCH"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.5029" x="881.7578" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.5029" x="888.7578" y="27.1074">OkvedScheduler</text></g><g class="participant participant-tail" data-participant="OSCH"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.5029" x="881.7578" y="694.6543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.5029" x="888.7578" y="716.7617">OkvedScheduler</text></g><g class="participant participant-head" data-participant="GH"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57.5723" x="1147.7095" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.5723" x="1154.7095" y="27.1074">GitHub</text></g><g class="participant participant-tail" data-participant="GH"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57.5723" x="1147.7095" y="694.6543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.5723" x="1154.7095" y="716.7617">GitHub</text></g><g class="message" data-participant-1="A" data-participant-2="OC"><polygon fill="#181818" points="330.6929,67.9121,340.6929,71.9121,330.6929,75.9121,334.6929,71.9121" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="43.3379" x2="336.6929" y1="71.9121" y2="71.9121"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.5615" x="50.3379" y="66.6494">POST (body = { "number": "..."})</text></g><g class="message" data-participant-1="OC" data-participant-2="OP"><polygon fill="#181818" points="503.5518,99.2031,513.5518,103.2031,503.5518,107.2031,507.5518,103.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="342.6929" x2="509.5518" y1="103.2031" y2="103.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.2554" x="349.6929" y="97.9404">process(number)</text></g><g class="message" data-participant-1="OP" data-participant-2="NN"><polygon fill="#181818" points="682.8789,130.4941,692.8789,134.4941,682.8789,138.4941,686.8789,134.4941" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="515.5518" x2="688.8789" y1="134.4941" y2="134.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.3271" x="522.5518" y="129.2314">normalizeNumber(number)</text></g><g class="message" data-participant-1="NN" data-participant-2="OP"><polygon fill="#181818" points="526.5518,161.7852,516.5518,165.7852,526.5518,169.7852,522.5518,165.7852" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="520.5518" x2="693.8789" y1="165.7852" y2="165.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.6099" x="532.5518" y="160.5225">response(true/false)</text></g><path d="M10,180.7852 L70.1709,180.7852 L70.1709,190.0762 L60.1709,200.0762 L10,200.0762 L10,180.7852" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="389.9961" style="stroke:#000000;stroke-width:1.5;" width="999.2607" x="10" y="180.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="25" y="195.8135">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="82.5107" x="85.1709" y="194.6553">[normalize true]</text><g class="message" data-participant-1="OP" data-participant-2="OS"><polygon fill="#181818" points="809.1855,219.3672,819.1855,223.3672,809.1855,227.3672,813.1855,223.3672" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="515.5518" x2="815.1855" y1="223.3672" y2="223.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.4136" x="522.5518" y="218.1045">processNumber()</text></g><g class="message" data-participant-1="OS" data-participant-2="OSCH"><polygon fill="#181818" points="928.5093,250.6582,938.5093,254.6582,928.5093,258.6582,932.5093,254.6582" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="821.1855" x2="934.5093" y1="254.6582" y2="254.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.5127" x="828.1855" y="249.3955">getItems()</text></g><g class="message" data-participant-1="OSCH" data-participant-2="OS"><polygon fill="#181818" points="832.1855,281.9492,822.1855,285.9492,832.1855,289.9492,828.1855,285.9492" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="826.1855" x2="939.5093" y1="285.9492" y2="285.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.1963" x="838.1855" y="280.6865">response(items)</text></g><g class="message" data-participant-1="OS" data-participant-2="OP"><polygon fill="#181818" points="526.5518,313.2402,516.5518,317.2402,526.5518,321.2402,522.5518,317.2402" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="520.5518" x2="820.1855" y1="317.2402" y2="317.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2471" x="532.5518" y="311.9775">response(responseBody)</text></g><g class="message" data-participant-1="OP" data-participant-2="OC"><polygon fill="#181818" points="353.6929,344.5313,343.6929,348.5313,353.6929,352.5313,349.6929,348.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="347.6929" x2="514.5518" y1="348.5313" y2="348.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.8589" x="359.6929" y="343.2686">response (responseBody)</text></g><g class="message" data-participant-1="OC" data-participant-2="A"><polygon fill="#181818" points="54.3379,479.5684,44.3379,483.5684,54.3379,487.5684,50.3379,483.5684" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48.3379" x2="341.6929" y1="483.5684" y2="483.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.1743" x="60.3379" y="374.5596">Response 200 (body =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.3418" x="63.9497" y="391.8506">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.5879" x="60.3379" y="409.1416">"phone_number": "...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.7397" x="60.3379" y="426.4326">"okved_number" : "...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.2397" x="60.3379" y="443.7236">"okved_code" : "..."</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.3022" x="60.3379" y="461.0146">"matching_length: "..."</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.6709" x="63.9497" y="478.3057">})</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="1009.2607" y1="492.5684" y2="492.5684"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="86.8022" x="15" y="504.4385">[normalize false]</text><g class="message" data-participant-1="OP" data-participant-2="OC"><polygon fill="#181818" points="353.6929,527.4902,343.6929,531.4902,353.6929,535.4902,349.6929,531.4902" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="347.6929" x2="514.5518" y1="531.4902" y2="531.4902"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.209" x="359.6929" y="526.2275">response (false)</text></g><g class="message" data-participant-1="OC" data-participant-2="A"><polygon fill="#181818" points="54.3379,558.7813,44.3379,562.7813,54.3379,566.7813,50.3379,562.7813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48.3379" x2="341.6929" y1="562.7813" y2="562.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275.355" x="60.3379" y="557.5186">Response 400 (body = {"error_message" : "..."})</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1210.2817" x="0" y="599.4268"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1210.2817" y1="599.4268" y2="599.4268"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1210.2817" y1="602.4268" y2="602.4268"/><rect fill="#EEEEEE" height="25.291" style="stroke:#000000;stroke-width:2;" width="64.5654" x="572.8582" y="587.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50.5654" x="578.8582" y="605.8096">periodic</text><g class="message" data-participant-1="OSCH" data-participant-2="GH"><polygon fill="#181818" points="1164.4956,642.3633,1174.4956,646.3633,1164.4956,650.3633,1168.4956,646.3633" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="940.5093" x2="1170.4956" y1="646.3633" y2="646.3633"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211.9863" x="947.5093" y="641.1006">getOkvedSchema(cron = '0 0 0 * * *')</text></g><g class="message" data-participant-1="GH" data-participant-2="OSCH"><polygon fill="#181818" points="951.5093,673.6543,941.5093,677.6543,951.5093,681.6543,947.5093,677.6543" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="945.5093" x2="1175.4956" y1="677.6543" y2="677.6543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.9917" x="957.5093" y="672.3916">getOkvedSchema()</text></g><!--SRC=[RLB1Ri8m3BtdAwnUW6bZQDe9gPCw3dINjbftH48XzI1QcrHfGDhG_drEImeTA9VglMVx-RarDrOAMNDb8H9M6-0DHAo-WDEl0nOBhQpHPOcj85rSApAZ1JPDro7D1e9aNstG9DfKl9G_NOyakUwHepb8WMs7_0OjTbZilOTy4GyaIsdZ_SPHovYn21vUo2VC8Klp3nXlTF4D8HmXKAsPO0x1T3eDVYUCL4wRaRRkbXXt6g8oHoK9KSgxxvRf9KJwQeDDhLM3Osls-FZ9omOdZF7Idel1KUpKDytF8qzTIKzeoorYOhTetonM3H4juglwKTAn4ryqSE4_NcbrlqgRY2VWlwGD8YB5krSypMPzTYi5nvKAwfrMk1wcU4-uTYVoE5mHGXVOmuHMt8gTLDjrYMfhTpq1T16av2uoQvEylS0fv1lEdo-S7mCqHfjrHK7pxTc66wKAniAmHYDr8KKOzZalJ_dtlrx5ny9eHVr6Ct3lphtHX2tZuSKkA-YWx0y0]--></g></svg>
* Алгоритм нормализации номера телефона имплементирован в классе NumberNormalizer
* Логика загрузки okved.json из репозитория представлена в классе OkvedScheduler (рекурсивный обход json-файла). CRON-job запускает метод getOkvedData (для удобства тестирования текущее cron-выражение соответствует загрузке раз в минуту. С учётом того условия, что схема обновляется раз в день, можно заменить cron-выражение на "0 0 0 * * *" в файле custom.properties).
* Алгоритм поиска наилучшего совпадения имплементирован в классе OkvedService. По умолчанию итерируемся по всем узлам, ищем такие узлы, на ОКВЭД-номера которых оканчивается номер телефона. Если таких узлов несколько, выбираем тот, у которого длина номера наибольшая. 
* Резервная стратегия: если совпадений нет, то вначале ищем совпадение по двум последним цифрам ОКВЭД-номера. Если и таких совпадений нет, то выдаём первый же ОКВЭД-номер, последняя цифра которого совпадает с последней цифрой номера телефона.
* Запустить приложение на localhost можно напрямую из среды разработки IntelliJIdea. По умолчанию приложение запускается на порту 8080.
* Доступен единственный эндпойнт для POST-запроса. Пример запроса:

```
POST 
http://localhost:8080/api/v1/okved
```

Пример тела запроса:

```
{
  "phone_number" : "+79269999909"
}
```
Пример корректного ответа (статус 200) 

```
{
  "phone_number": "+79269999909",
  "okved_code": "09",
  "okved_name": "Предоставление услуг в области добычи полезных ископаемых",
  "matching_length": 2
}
```

Пример ответа на запрос, содержащий некорректный номер телефона (статус 400)
```
{
  "error_message": "The number doesn't match to Russian mobile number standards"
}
```
* Классы OkvedService и NumberNormalizer покрыты юнит-тестами